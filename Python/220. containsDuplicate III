from sortedcontainers import SortedDict
class Solution:
    def containsNearbyAlmostDuplicate(self, nums: List[int], k: int, t: int) -> bool:
        if k < 0 or t < 0:
            return False
        
        sd = SortedDict()
        
        for i, x in enumerate(nums):
            if sd.bisect_right(x+t) - sd.bisect_left(x-t) > 0:
                return True
            if not x in sd:
                sd[x] = 1
            
            if len(sd) > k:
                y = nums[i-k]
                sd[y] -= 1
                if sd[y] == 0:
                    del sd[y]
                    
        return False
